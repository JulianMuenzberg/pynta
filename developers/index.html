

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Information for Developers &mdash; PyNTA 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="pynta package" href="pynta.html" />
    <link rel="prev" title="Setting up a Python Virtual Environment" href="../making_virtual_environment.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PyNTA
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../example_config.html">The Config File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute_codebase.html">How to Contribute Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../making_virtual_environment.html">Setting up a Python Virtual Environment</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Information for Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#controller">Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model">Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#models-for-the-cameras">Models for the Cameras</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-for-the-experiment">Model for the Experiment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#view">View</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pynta.html">pynta package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../list_todo.html">List of Todo’s</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyNTA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Information for Developers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developers/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="information-for-developers">
<span id="for-developers"></span><h1>Information for Developers<a class="headerlink" href="#information-for-developers" title="Permalink to this headline">¶</a></h1>
<p>In these pages you will find the information needed for expanding the codebase of PyNTA. You can go through the
documentation of every module by following the links at the bottom of the page. However, there are some general guidelines regarding how to understand the code that can help you pin point the specific parts of the program that you would like to modify.</p>
<p>The design pattern chosen for the program is called MVC, that stands for Model-View-Controller. This pattern splits the different attributions of the code in order to make it more reusable. You can find a discussion about the MVC for lab applications on <a class="reference external" href="https://www.uetke.com/blog/general/the-mvc-pattern-for-lab-projects/">this website</a>. The general principle is that by generating clear differences between parts of the program, you can obtain a highly sustainable program. Below you can see a description of what every module is and how you can help expanding it.</p>
<p>Every module will have its own particularities, which are explained briefly below. For more information, you should see the individual documentation and go through the code to understand better how the program’s architecture was developed. It is important to note that PyNTA is a highly parallelized program. It relies on <strong>zeromq</strong> to pass messages between different processes. We have implemented a publisher/subscriber architecture that allows one central process to broadcast messages which can be captured by any listening procedure. This enables to spin on or off processes without altering the code. Moreover, it would make a clear path for remote control, data storage, etc.</p>
<p>The decentralized architecture of PyNTA makes it very flexible and powerful, but it also makes the code base much harder to understand for novice developers. Asynchronous programming is not a trivial task and can confuse people who are new to programming complex solutions (the code is no longer read from top to bottom). <strong>Zeromq</strong> was easy to implement, but may not be the best performing library for heavy numpy applications. Better approaches may be found in the future without compromising the existing code.</p>
<p>Below you will find an introduction to the code architecture. Read through to understand where to find answers and where is the proper place to implement updates and solutions.</p>
<div class="section" id="controller">
<h2>Controller<a class="headerlink" href="#controller" title="Permalink to this headline">¶</a></h2>
<p>In our definition of the MVC pattern, <a class="reference internal" href="pynta.controller.html#module-pynta.controller" title="pynta.controller"><code class="xref py py-mod docutils literal notranslate"><span class="pre">controllers</span></code></a> are the drivers of the devices. Controllers for cameras, for example, rely on library files (.dll files on Windows, .so in Linux) that can be more or less documented. For example <a class="reference internal" href="pynta.controller.devices.hamamatsu.html#module-pynta.controller.devices.hamamatsu" title="pynta.controller.devices.hamamatsu"><code class="xref py py-mod docutils literal notranslate"><span class="pre">hamamatsu</span></code></a> uses the <em>DCAM-API</em>, while <a class="reference internal" href="pynta.controller.devices.photonicscience.html#module-pynta.controller.devices.photonicscience" title="pynta.controller.devices.photonicscience"><code class="xref py py-mod docutils literal notranslate"><span class="pre">photonicscience</span></code></a> uses <em>scmoscam.dll</em>. Controllers should follow the specifications of each device as closely as possible. For instance, the units each devices uses for setting exposure times or framerates, etc. Moreover, they shouldn’t implement anything that the device is not capable of doing. A clear example would be to set a region of interest. Some cameras support it but some don’t. You could be tempted to apply a ROI in the software directly, but you shouldn’t do it in the Controller, there is a better place as we will see later.</p>
<p>Controllers are not always plain python files, sometimes are entire packages on themselves. For instance, the controller for Basler cameras (PyPylons) or National Instruments cards (pyDAQmx) are packages on their own. Sometimes the controllers where developed by other people, like the case of the Hamamatsu code, which was borrowed from Zhuang’s lab. If you explore the controllers folder, you will notice that there are some available, like the <a class="reference internal" href="pynta.controller.devices.keysight.html#module-pynta.controller.devices.keysight" title="pynta.controller.devices.keysight"><code class="xref py py-mod docutils literal notranslate"><span class="pre">keysight</span></code></a> ,that holds the drivers for an oscilloscope and function generator. Those controllers are remnants of a different incarnation of PyNTA, but that may still be valuable for the future.</p>
</div>
<div class="section" id="model">
<h2>Model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="models-for-the-cameras">
<h3>Models for the Cameras<a class="headerlink" href="#models-for-the-cameras" title="Permalink to this headline">¶</a></h3>
<p>Models define the way the users will interact with the devices. Imagine you have a camera that doesn’t support setting a region of interest (ROI), you can still crop the resulting images in the software, giving the same result as what a camera that does support ROI does. By having an intermediate layer between the controllers and the users, it is possible to detach the specific logic of an experiment and the specifications of the devices. Moreover, it makes very straightforward to add new devices to the experiment, exchanging cameras, etc.</p>
<p>Therefore in <a class="reference internal" href="pynta.model.cameras.html"><span class="doc">pynta.model.cameras package</span></a> is where we will develop classes that have always the same methods and outputs defined, but that behave completely different when communicating with the devices. The starting point is the <a class="reference internal" href="pynta.model.cameras.html#module-pynta.model.cameras.skeleton" title="pynta.model.cameras.skeleton"><code class="xref py py-mod docutils literal notranslate"><span class="pre">skeleton</span></code></a>, where the <code class="docutils literal notranslate"><span class="pre">cameraBase</span></code> class is defined. In this class all the methods and variables needed by the rest of the program are defined. This strategy not only allows to keep track of the functions, it also enables the subclassing, which will be discussed later.</p>
<p>Having models also allow to quickly change from one camera to another. For example, if one desires to switch from a <a class="reference internal" href="pynta.model.cameras.html#module-pynta.model.cameras.hamamatsu" title="pynta.model.cameras.hamamatsu"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Hamamatsu</span></code></a> to a <a class="reference internal" href="pynta.model.cameras.html#module-pynta.model.cameras.psi" title="pynta.model.cameras.psi"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PSI</span></code></a>, the only needed thing to do is to replace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pynta.model.cameras.hamamatsu</span> <span class="k">import</span> <span class="n">camera</span>
</pre></div>
</div>
<p>With:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pynta.model.cameras.psi</span> <span class="k">import</span> <span class="n">camera</span>
</pre></div>
</div>
<p>As you see, both modules <code class="docutils literal notranslate"><span class="pre">Hamamatsu</span></code> and <code class="docutils literal notranslate"><span class="pre">PSI</span></code> define a class called camera. And this classes will have the same methods defined, therefore whatever code relies on camera will be working just fine. One of the obvious advantages of having a Model is that we can define a <code class="xref py py-mod docutils literal notranslate"><span class="pre">Dummy</span> <span class="pre">Camera</span></code> that allows to test the code without being connected to any real device.</p>
<p>If you go through the code, you’ll notice that the classes defined in Models inherit <code class="docutils literal notranslate"><span class="pre">cameraBase</span></code> from the <a class="reference internal" href="pynta.model.cameras.html#module-pynta.model.cameras.skeleton" title="pynta.model.cameras.skeleton"><code class="xref py py-mod docutils literal notranslate"><span class="pre">skeleton</span></code></a>. The quick advantage of this is that any function defined in the skeleton will be already available in the child objects. Therefore, if you want to add a new function, let’s say <code class="docutils literal notranslate"><span class="pre">set_gain</span></code>, you will have to start by adding that method to the <code class="docutils literal notranslate"><span class="pre">skeleton</span></code>. This will make the function readily available to all the models, even if just as a mockup or to <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">NotImplementedError</span></code>. Then we can overload the method by defining it again in the class we are working on. It may be that not all the cameras are able to set a gain, and we can just leave a function that <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">True</span></code>. If it is a functionality that you expect any camera to have, for example triggering an image acquisition, you can set the skeleton function to <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">NotImplementedError</span></code>. This will give a very descriptive error of what went wrong if you haven’t implemented the function in your model class.</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">It is also possible to define the methods as <code class="docutils literal notranslate"><span class="pre">&#64;abstractmethods</span></code> which will automatically raise an exception. It may be worth exploring this possibility if there are several developers involved.</p>
</div>
</div>
<div class="section" id="model-for-the-experiment">
<h3>Model for the Experiment<a class="headerlink" href="#model-for-the-experiment" title="Permalink to this headline">¶</a></h3>
<p>The way a user interacts with a camera is only part of the logic of an experiment. There are a lot of different steps and conditions that a person needs in order to obtain data. In the case of PyNTA, one of the requirements would be to analyse the images being acquired by a camera in real time and track the particles on them. Therefore, the best solution in order to develop clear code is to generate a new class for the experiment itself. You can see it in <a class="reference internal" href="pynta.model.experiment.html#module-pynta.model.experiment" title="pynta.model.experiment"><code class="xref py py-mod docutils literal notranslate"><span class="pre">experiment</span></code></a> (the general, base one) or on <a class="reference internal" href="pynta.model.experiment.nano_cet.html#module-pynta.model.experiment.nano_cet" title="pynta.model.experiment.nano_cet"><code class="xref py py-mod docutils literal notranslate"><span class="pre">nano_cet</span></code></a>, a more elaborated one.</p>
<p>The idea behind the experiment model is that it makes it very clear what the logic of the experiment is. You need to load a camera, you need to acquire a movie, you need to analyse the frames, etc. It is very easy to add new steps, change the order in which different things happen, etc. Depending on the developer, starting with the experiment model may be the best place to implement changes, since it makes it very clear what is happening and what can be improved. A good idea would be to start developing your own experiment as a command-line based tool.</p>
</div>
</div>
<div class="section" id="view">
<h2>View<a class="headerlink" href="#view" title="Permalink to this headline">¶</a></h2>
<p>The View is, as the name suggests, where the GUI is defined. Since we defined all the logic of the experiment in a separate class, the View takes care of only triggering specific steps of the experiment and displaying the results. In principle, the only logic present in the view modules is only for aesthetic reasons. For instance, disable a specific button while a measurement is going on, etc. However, it should be the experiment model the one that avoids triggering two measurements if it is not possible, etc. That guarantees a lower-level safety.</p>
<p><a class="reference internal" href="pynta.view.html"><span class="doc">pynta.view package</span></a> is where the GUI lives. Within the module, you will also find <a class="reference internal" href="pynta.view.GUI.html"><span class="doc">pynta.view.GUI package</span></a>, in which the different widgets that make up the window are defined and another folder called designer, where the Qt Designer files are located. Adapting the looks of a program should start by looking into the <code class="docutils literal notranslate"><span class="pre">.ui</span></code> files, then checking the associated widgets in the <code class="docutils literal notranslate"><span class="pre">GUI</span></code> module, in order to connect the proper signals, etc. and finally modifying the main view class.</p>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pynta.html">pynta package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pynta.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pynta.controller.html">Pynta Controllers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="pynta.controller.html#hamamatsu-camera-py">hamamatsu_camera.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pynta.exceptions.html">pynta.exceptions package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="pynta.exceptions.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.exceptions.html#module-pynta.exceptions.exceptions">pynta.exceptions.exceptions module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.exceptions.html#module-pynta.exceptions">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pynta.model.html">pynta.model package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="pynta.model.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.model.html#module-pynta.model">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pynta.tests.html">pynta.tests package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="pynta.tests.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.tests.html#module-pynta.tests.test_controllers">pynta.tests.test_controllers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.tests.html#module-pynta.tests.test_examples">pynta.tests.test_examples module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.tests.html#module-pynta.tests.test_models">pynta.tests.test_models module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.tests.html#module-pynta.tests.test_zmq">pynta.tests.test_zmq module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.tests.html#module-pynta.tests">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pynta.tools.html">pynta.tools package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="pynta.tools.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.tools.html#module-pynta.tools.worker_thread">pynta.tools.worker_thread module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.tools.html#module-pynta.tools">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pynta.util.html">pynta.util package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="pynta.util.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.util.html#module-pynta.util.circular_buffer">pynta.util.circular_buffer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.util.html#module-pynta.util.importer">pynta.util.importer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.util.html#module-pynta.util.log">pynta.util.log module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.util.html#module-pynta.util">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pynta.view.html">pynta.view package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="pynta.view.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.view.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.view.html#module-pynta.view.main">pynta.view.main module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.view.html#module-pynta.view.subscriber_thread">pynta.view.subscriber_thread module</a></li>
<li class="toctree-l4"><a class="reference internal" href="pynta.view.html#module-pynta.view">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pynta.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="pynta.html#module-pynta.config">pynta.config module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="pynta.html#pynta-config">PyNTA Config</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pynta.html#module-pynta">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pynta.html" class="btn btn-neutral float-right" title="pynta package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../making_virtual_environment.html" class="btn btn-neutral" title="Setting up a Python Virtual Environment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Aquiles Carattino

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>